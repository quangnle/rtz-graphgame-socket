<!DOCTYPE html>
<html>

<head>
    <title>Demo pop up donate</title>
    <style>
        body {
            margin: 0;
            padding-bottom: 3rem;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        #messages {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
    </style>
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script type="module">
        import { io } from "https://cdn.socket.io/4.4.1/socket.io.esm.min.js";
        // import axios from 'axios';
        // const socket = io('wss://message-gifting.techwiz.tech:443')
        // const socket = io('ws://localhost:5861')
        const tokenClient = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY1OGQzOWU3NWZlYzdlYzhiYWE4ZTIyNSIsImFkZHJlc3MiOiIweDQ2Yjc4YzkzNmIwMDg1Y2NmODEwMDMxNTMyMmY1M2Y5ZmFjM2IyNjUiLCJub25jZSI6IkZrNFJDMng1Rkc0ZiIsImlhdCI6MTcwMzc1NTMyNCwiZXhwIjoxNzA0NDc1MzI0fQ.VTEPQMEvE0Q1n8wNyP0G5ScsEWM-BUwiZ26pg_Pfhkk'
        const socket = io.connect('ws://localhost:5861',{ query: `tokenClient=${tokenClient}` });

        const button = document.getElementById('jump')
        button.addEventListener('click', function() {
            socket.emit('player-jump-server', {})
        })


        const headers = { 'Authorization': `Bearer ${tokenClient}` }
        let idRound = null
        const buttonJoin = document.getElementById('join')
        buttonJoin.addEventListener('click', function() {
            const url = `http://localhost:4205/rounds/${idRound}/join`
            axios.patch(url, 
            {
                amount: 14,
            },
            {
                headers: headers    
            })
            .then(function (response) {
                console.log(response);
            })
            .catch(function (error) {
                console.log(error);
            })
            .finally(function () {
                // always executed
            });
        })

        socket.on('connect_error', err => {
            console.log(123)
            console.log(err instanceof Error)
            console.log(err.message)
        })

        console.log(socket)
        
        socket.on('ping', function(msg) {
            console.log('ping msg', msg)
        })

        socket.on('next-round', function(msg) {
            console.log('next-round msg', msg)
            const { isStart, round } = msg
            if (!isStart) {
                idRound = round._id.toString()
            }
        })

        socket.on('events', function(msg) {
            console.log('events msg', msg)
        })

        socket.on('player-jump-client', function(msg) {
            console.log('events msg', msg)
        })
    </script>

</head>

<body>
    <div id="body">
        <div id="messages"></div>
        <button id="join">Join</button>
        <button id="jump">Jump</button>
    </div>

</body>


</html>